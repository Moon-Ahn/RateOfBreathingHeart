import numpy as np
import matplotlib.pyplot as plt
import scipy.signal

# 심박신호를 일정한 간격으로 공급
raw_signal = np.array([0.07915026
,0.14713599
,0.14321962
,0.08415075
,0.02889405
,0.004826814
,-0.011799965
,-0.017073054
,0.0564297
,0.15455423
,0.090695605
,-0.09463709
,-0.13751665
,0.019178651
,0.16632041
,0.15394282
,0.044691965
,-0.027072221
,-0.06543568
,-0.2063342
,-0.40747362
,-0.38196173
,-0.05384375
,0.26089707
,0.28249162
,0.09085349
,-0.047019456
,-0.022886097
,0.03321722
,-0.013392855
,-0.1176585
,-0.14706112
,-0.059289828
,0.07325651
,0.16395575
,0.19259542
,0.18307629
,0.13022873
,0.023760855
,-0.07751574
,-0.10509801
,-0.07573104
,-0.040117107
,-0.006086048
,0.032347105
,0.0496733
,0.011333525
,-0.062622815
,-0.09181871
,-0.038840838
,0.026366118
,0.033928942
,0.015493382
,0.011674969
,-0.012225021
,-0.07311997
,-0.11572407
,-0.09857805
,-0.045312017
,0.007608816
,0.050013542
,0.06447688
,0.027339943
,-0.030390747
,-0.024989314
,0.07386291
,0.17513317
,0.19873048
,0.18352476
,0.14758582
,0.040014833
,-0.10293862
,-0.17138788
,-0.1568401
,-0.14609003
,-0.15162474
,-0.08182885
,0.075509
,0.13114625
,-0.06427248
,-0.32139888
,-0.31623948
,-0.018681318
,0.28213894
,0.34183732
,0.20488712
,0.05490193
,-0.015272595
,-0.025131006
,-0.019719929
,-0.016774546
,-0.01622054
,-0.017821828
,-0.01085142
,0.016476663
,0.044884406
,0.039634734
,0.001423746
,-0.03349614
,-0.044753097
,-0.048706006
,-0.053259324
,-0.034854047
,0.002498411
,0.016536877
,9.40E-04
,-0.015024763
,-0.025826646
,-0.0363902
,-0.025160756
,0.01728693
,0.05119236
,0.046726014
,0.033328734
,0.04474843
,0.052212715
,0.00600012
,-0.06625274
,-0.07363644
,0.018015426
,0.12666416
,0.14546317
,0.07449725
,-0.007642105
,-0.0632467
,-0.11243923
,-0.18497929
,-0.26295966
,-0.25234562
,-0.091266334
,0.13244618
,0.2550472
,0.1825972
,-0.021778964
,-0.12135425
,0.07272137
,0.38550594
,0.42425215
,0.08978093
,-0.2701141
,-0.2717429
,0.06981383
,0.36763895
,0.22684051
,-0.34881845
,-0.7874695
,-0.45649663
,0.37495303
,0.5773696
,-0.2880183
-1.1774278
,-0.9835069
,0.034614682
,0.8101588
,0.8266883
,0.4493062
,0.24697375
,0.35317308
,0.48426193
,0.39938328
,0.14740467
,-0.1019091
,-0.25784582
,-0.31822926
,-0.31707543
,-0.29783133
,-0.28302097
,-0.26152372
,-0.2089254
,-0.10868819
,0.019076109
,0.11544606
,0.13966116
,0.10211634
,0.036777228
,-0.017941512
,-0.020052396
,0.041455694
,0.11623561
,0.14581552
,0.15872371
,0.20322295
,0.13158631
,-0.22901964
,-0.62528515
,-0.5943446
,-0.11953512
,0.35537347
,0.4801795
,0.30777574
,0.10915801
,0.048228845
,0.07562646
,0.0680134
,-0.010117874
,-0.117201254
,-0.21792714
,-0.23353355
,-0.046905037
,0.27073255
,0.4310872
,0.26856968
,-0.06305477
,-0.29103315
,-0.2996565
,-0.1859684
,-0.10937776
,-0.12448316
,-0.17620903
,-0.2010219
,-0.15987423
,-0.046602517
,0.08404806
,0.16689551
,0.19484371
,0.19577874
,0.18609512
,0.17638215
,0.18516932
,0.20888484
,0.1948088
,0.08925158
,-0.07434657
,-0.1737527
,-0.13196698
,-0.026408926
,2.17E-04
,-0.08884883
,-0.20739356
,-0.2684151
,-0.25119725
,-0.16931468
,-0.043763965
,0.08878794
,0.17862192
,0.1987947
,0.1697122
,0.12132881
,0.050173916
,-0.05309492
,-0.1469591
,-0.15401167
,-0.053363897
,0.07408659
,0.12584701
,0.08391084
,0.009170763
,-0.040497042
,-0.055420198
,-0.055587552
,-0.038231585
,0.021121226
,0.10691124
,0.17043823
,0.19329734
,0.19070615
,0.16025405
,0.06322542
,-0.10968277
,-0.2878257
,-0.38896853
,-0.4013616
,-0.36107606
,-0.27591857
,-0.11799747
,0.09901041
,0.28891453
,0.37358993
,0.35384113
,0.2809716
,0.19919513
,0.123752415
,0.056831717
,0.010944992
,-0.013431758
,-0.04896006
,-0.11446458
,-0.18287434
,-0.22407773
,-0.22971095
,-0.18154153
,-0.06819391
,0.057205364
,0.11410143
,0.09615566
,0.082238466
,0.12436616
,0.16381183
,0.11712388
,0.01670593
,-0.019763276
,0.035508513
,0.04940532
,-0.11312936
,-0.37314278
,-0.49240083
,-0.3537313
,-0.07480264
,0.081870586
,-0.013831675
,-0.03779617
,0.38622501
,0.9424976
,0.9771303
,0.42245114
,-0.16310525
,-0.29044378
,-0.10492408
,-0.14200854
,-0.5072706
,-0.7640593
,-0.651345
,-0.3816449
,-0.21565014
,-0.14233524
,-0.030950308
,0.15428191
,0.36717707
,0.56307846
,0.6973481
,0.70720816
,0.54527247
,0.23483855
,-0.110667706
,-0.36254805
,-0.47579324
,-0.4753373
,-0.39511305
,-0.2617723
,-0.08057293
,0.14897549
,0.36843526
,0.45579132
,0.3421123
,0.10906771
,-0.100765586
,-0.23740765
,-0.34018755
,-0.46038708
,-0.62378544
,-0.70415527
,-0.41030794
,0.286974
,0.88997746
,0.9048478
,0.44784203
,0.021729618
,-0.12442969
,-0.12916034
,-0.15403977
,-0.16251436
,-0.039067805
,0.19465737
,0.32363456
,0.17080005
,-0.13748845
,-0.29033005
,-0.17990837
,-0.01354239
,-0.010285163
,-0.1341463
,-0.20385873
,-0.1548101
,-0.081534624
,-0.05410862
,0.004876852
,0.19489919
,0.43767413
,0.5231199
,0.3678395
,0.113324344
,-0.071138054
,-0.16563442
,-0.23183718
,-0.29295045
,-0.33021158
,-0.31978446
,-0.25450242
,-0.15321079
,-0.046562493
,0.044434696
,0.10862091
,0.13296503
,0.11037162
,0.0701347
,0.0889299
,0.22476034
,0.4209032
,0.5228281
,0.4187292
,0.14941108
,-0.13244456
,-0.30705726
,-0.3727687
,-0.40086952
,-0.44207668
,-0.48761806
,-0.50865567
,-0.45288646
,-0.2194978
,0.19204408
,0.58529687
,0.77625537
,0.75913024
,0.6080671
,0.34456614
,-0.066957355
,-0.5204799
,-0.63491094
,-0.18995069
,0.39395118
,0.48507077
,0.0315589
,-0.45240822
,-0.5686951
,-0.40153235
,-0.2328954
,-0.16456404
,-0.09555876
,0.112392664
,0.45136127
,0.64640313
,0.42048848
,-0.056464374
,-0.3130883
,-0.1785453
,0.07259379
,0.13522461
,-0.002329961
,-0.14330551
,-0.15362765
,-0.08164181
,-0.039388545
,-0.0502443
,-0.052682616
,0.002478361
,0.10779436
,0.20720652
,0.21573997
,0.08929314
,-0.09521252
,-0.18768443
,-0.120919615
,0.019156082
,0.0847971
,-0.041095365
,-0.39911208
,-0.7932366
,-0.74974346
,0.044638813
,1.1977466
,1.7899019
,1.3428732
,0.3413788
,-0.4196577
,-0.65164936
,-0.61227185
,-0.63530076
,-0.7606089
,-0.7684543
,-0.5084957
,-0.11157197
,0.15694404
,0.1924507
,0.13001812
,0.14591122
,0.2665786
,0.3868599
,0.41069096
,0.3423773
,0.24624382
,0.15616667
,0.07645178
,0.026002109
,9.47E-04
,-0.051043272
,-0.1435411
,-0.21091706
,-0.2165424
,-0.21253116
,-0.23343018
,-0.22944178
,-0.1615192
,-0.061846137
,0.038525075
,0.14315423
,0.22964564
,0.24472691
,0.18072945
,0.094388336
,0.029462866
,-0.028529346
,-0.09419486
,-0.13503361
,-0.11352354
,-0.03808427
,0.03897646
,0.05682469
,-0.003825168
,-0.080106296
,-0.07735072
,0.005085602
,0.06990229
,0.068653084
,0.057279974
,0.09628617
,0.18334529
,0.2341237
,0.086774945
,-0.27754647
,-0.55435324
,-0.46158284
,-0.12365657
,0.15239307
,0.25937536
,0.26865578
,0.2279881
,0.11506358
,-0.0632631
,-0.1842659
,-0.10865529
,0.12100264
,0.3016625
,0.2838329
,0.078846306
,-0.17356908
,-0.313124
,-0.28952825
,-0.17140782
,-0.0817238
,-0.08136056
,-0.060740173
,0.08135633
,0.23816502
,0.274681
,0.22867501
,0.19103852
,0.14711082
,0.038186908
,-0.11903305
,-0.24317068
,-0.27667347
,-0.2296248
,-0.1546643
,-0.11022657
,-0.12949573
,-0.18348433
,-0.18323013
,-0.047130913
,0.21094662
,0.4633872
,0.55906785
,0.4280876
,0.13960868
,-0.1280461
,-0.23940423
,-0.20743567
,-0.126546
,-0.043475807
,0.06160202
,0.14211729
,0.06978517
,-0.14625573
,-0.30698296
,-0.28020468
,-0.13714014
,0.002068862
,0.09719105
,0.14773014
,0.15183291
,0.12953097
,0.12044337
,0.12819098
,0.11374755
,0.06696482
,0.00692445
,-0.07359427
,-0.17528605
,-0.25766662
,-0.27848953
,-0.22544721
,-0.118988544
,1.28E-04
,0.09711912
,0.16551825
,0.21637395
,0.21053654
,0.079010725
,-0.056052126
,0.089766964
,0.483116
,0.6779011
,0.39127743
,-0.15398544
,-0.53238845
,-0.5561987
,-0.37441626
,-0.22901303
,-0.20363855
,-0.22497988
,-0.2188353
,-0.17175826
,-0.08350116
,0.063929856
,0.23198909
,0.22279844
,-0.045525283
,-0.1654846
,0.26778984
,0.86936843
,0.85572845
,0.1651963
,-0.44480476
,-0.46901292
,-0.15870933
,0.1316991
,0.28248864
,0.107631356
,-0.427292
,-0.86102974
,-0.7355656
,-0.18417418
,0.30469924
,0.4618277
,0.3859465
,0.281868
,0.20998342
,0.107716255
,-0.037216738
,-0.14989385
,-0.16390984
,-0.07846485
,0.0440035
,0.11669715
,0.09814708
,0.027152017
,-0.03486377
,-0.073273614
,-0.08501435
,-0.038236476
,0.049798124
,0.09159667
,0.04485152
,-0.06588815
,-0.1902181
,-0.21751495
,-0.080299646
,0.09207395
,0.14237425
,0.11323559
,0.12720227
,0.17149581
,0.12699625
,-0.04938434
,-0.24292846
,-0.29979917
,-0.19032164
,-0.015666619
,0.10983151
,0.13741635
,0.08164104
-7.41E-05
,-0.041648015
,-0.024025597
,0.015655056
,0.039786395
,0.054180995
,0.08796944
,0.13279021
,0.121615335
,0.02533333
,-0.0522943
,-0.021802783
,0.019216537
,-0.019524872
,-0.026569292
,0.06040187
,0.04490617
,-0.2178791
,-0.5007112
,-0.47481486
,-0.15975788
,0.14411944
,0.253155
,0.23911281
,0.23962866
,0.26786456
,0.24594244
,0.14659597
,9.25E-04
,-0.1565448
,-0.2605273
,-0.24688813
,-0.13410252
,0.00411126
,0.13610823
,0.31937397
,0.5338717
,0.51382977
,0.047597468
,-0.60644084
,-0.9197956
,-0.6445475
,0.039007455
,0.7186345
,0.91358876
,0.34084272
,-0.7274143
-1.4883509
-1.2303582
,-0.10748565
,0.84700584
,0.79347676
,0.04825127
,-0.36723006
,-0.010039955
,0.57383204
,0.75321573
,0.60270965
,0.5182736
,0.53909004
,0.41094947
,0.031605363
,-0.40632927
,-0.6223482
,-0.48823538
,-0.1573644
,-0.045441955
,-0.4178561
,-0.92952275
,-0.9615193
,-0.4019425
,0.25239396
,0.5509053
,0.536675
,0.45437494
,0.36689308
,0.2390162
,0.09161912
,-0.053542256
,-0.17944312
,-0.20751143
,-0.084303126
,0.08999497
,0.15218037
,0.05605211
,-0.11026333
,-0.18777719
,-0.022744264
,0.3385613
,0.5709335
,0.39454123
,-0.079289526
,-0.47396505
,-0.55345213
,-0.4023899
,-0.24529433
,-0.17936176
,-0.1064975
,0.09452531
,0.36141258
,0.47700417
,0.33466414
,0.094068214
,-0.008288428
,0.059230953
,0.12203267
,0.036383003
,-0.15939502
,-0.3223801
,-0.3606164
,-0.29068568
,-0.19060779
,-0.122886926
,-0.08874583
,-0.036702037
,0.087611854
,0.27338284
,0.41518185
,0.38670328
,0.19116908
,-0.00304307
,-0.05914919
,-0.043627486
,-0.099922776
,-0.20033194
,-0.16229966
,0.06370899
,0.28191718
,0.30108747
,0.14482875
,-0.037791908
,-0.13768907
,-0.14892003
,-0.14664063
,-0.19445902
,-0.26134574
,-0.26130185
,-0.1539259
,0.016232073
,0.14343865
,0.14057608
,0.031998783
,-0.056901067
,-0.025535747
,0.09468937
,0.18877302
,0.19885379
,0.158812
,0.11599162
,0.08032417
,0.030488431
,-0.052206337
,-0.14343381
,-0.18422352
,-0.13640878
,-0.016690303
,0.10833502
,0.15941048
,0.10839843
,0.003213674
,-0.084379025
,-0.102277935
,-0.023306284
,0.08596284
,0.043366123
,-0.21678701
,-0.46301046
,-0.4181808
,-0.10495654
,0.2021243
,0.3003594
,0.23473755
,0.16506264
,0.15873113
,0.149932
,0.035214067
,-0.15994853
,-0.21586207
,0.009902816
,0.32475823
,0.42998114
,0.28049257
,0.06212479
,-0.06889981
,-0.114542395
,-0.20547256
,-0.48332208
,-0.7788048
,-0.5926811
,0.16244373
,0.8252479
,0.79362464
,0.21751508
,-0.32149535
,-0.4810162
,-0.35148752
,-0.18041977
,-0.09513524
,-0.06378162
,-0.011247933
,0.07539567
,0.14617324
,0.17466146
,0.2033102
,0.2648933
,0.30593053
,0.24284764
,0.071780264
,-0.100287825
,-0.13301435
-6.11E-04
,0.12742865
,0.03466606
,-0.2748089
,-0.51566
,-0.3789856
,0.08050431
,0.34913236
,0.042895496
,-0.47949335
,-0.5610606
,-0.12311581
,0.35007936
,0.48640084
,0.35001358
,0.20156375
,0.17423928
,0.21178582
,0.20027468
,0.09765455
,-0.040020436
,-0.13503417
,-0.17574966
,-0.20770685
,-0.24417222
,-0.21614452
,-0.06744774
,0.07675472
,-0.001047403
,-0.27615705
,-0.4534821
,-0.3053519
,0.10025594
,0.4543796
,0.4988335
,0.31008238
,0.17046762
,0.17708646
,0.17348585
,0.043965936
,-0.12989515
,-0.20809437
,-0.15883672
,-0.07898274
,-0.072255224
,-0.122288
,-0.1307434
,-0.06553626
-8.74E-04
,0.004008167
,-0.00829877
,0.029856265
,0.11056539
,0.166899
,0.14790964
,0.055453993
,-0.060139433
,-0.13119695
,-0.13160594
,-0.098982684
,-0.07897486
,-0.07860404
,-0.08485828
,-0.086901635
,-0.06350072
,0.012691408
,0.12823597
,0.21570325
,0.22343558
,0.16897689
,0.09387065
,0.022759974
,-0.017801523
,-0.022862852
,-0.032701686
,-0.059854567
,-0.057846844
,-0.007564984
,0.040137984
,0.034602307
,-0.006037407
,-0.038518272
,-0.076545775
,-0.14812821
,-0.19906916
,-0.14059211
,0.009488583
,0.13336186
,0.1523013
,0.07388078
,-0.037395786
,-0.08921942
,-0.03918311
,0.047471333
,0.07230902
,0.03349328
,0.024694068
,0.09129115
,0.1526758
,0.1074744
,-0.030701041
,-0.15034977
,-0.17356184
,-0.12339277
,-0.05347263
,0.024196804
,0.09771913
,0.117512286
,0.06164377
,-0.019558057
,-0.07231327
,-0.10521155
,-0.16676687
,-0.26082194
,-0.23915547
,0.07809469
,0.550477
,0.75666964
,0.50331163
,0.04142511
,-0.26747367
,-0.31356502
,-0.24736458
,-0.24667774
,-0.31992704
,-0.327389
,-0.16489469
,0.10541713
,0.2999031
,0.2966176
,0.16173571
,0.047088284
,0.009603553
,0.01185818
,0.021665849
,-0.007109091
,-0.13116217
,-0.2891398
,-0.33449307
,-0.2267005
,-0.06293446
,0.053269506
,0.10232106
,0.12671205
,0.16599193
,0.22023816
,0.25595632
,0.24114875
,0.17748022
,0.09903017
,0.041680127
,0.007484466
,-0.04333338
,-0.12810028
,-0.17264837
,-0.10714491
,-0.018877387
,-0.05624059
,-0.19395286
,-0.24925497
,-0.13172573
,0.044057623
,0.11077049
,0.03719291
,-0.06274945
,-0.07031973
,0.019012943
,0.114225864
,0.15325415
,0.1400904
,0.06871201
,-0.051071577
,-0.12476812
,-0.075388215
,0.023280853
,0.0467412
,0.013241705
,0.032946587
,0.11103277
,0.14465237
,0.08353568
,-0.010840341
,-0.061952442
,-0.064041354
,-0.041079015
,-0.011106044
,-0.03739515
,-0.165132
,-0.28614035
,-0.23602775
,-0.02013132
,0.18944052
,0.25985754
,0.20708779
,0.123705745
,0.06571439
,0.020746768
,-0.026590005
,-0.039889723
,0.005621746
,0.055548698
,0.047714576
,-0.007532701
,-0.07835448
,-0.16854008
,-0.2577173
,-0.26738137
,-0.16304903
,-0.012260526
,0.11087072
,0.21102546
,0.3212313
,0.40156555
,0.3459714
,0.10998973
,-0.1944963
,-0.36860907
,-0.31739476
,-0.1503987
,-0.06112101
,-0.12023965
,-0.2173218
,-0.20168637
,-0.040773094
,0.16338566
,0.2814077
,0.2695283
,0.18711066
,0.116322994
,0.07459942
,0.02832532
,-0.022191927
,-0.0399397
,-0.021058574
,0.001220822
,0.00694184
,-0.014054716
,-0.08626356
,-0.17431432
,-0.14500397
,0.043335836
,0.21407121
,0.19677313
,0.04307828
,-0.09567414
,-0.15632543
,-0.15696335
,-0.10817993
,-0.00218676
,0.1190042
,0.15200637
,0.039512493
,-0.13151258
,-0.19370747
,-0.08788003
,0.07253492
,0.14617093
,0.1016657
,0.010503933
,-0.047548614
,-0.061160833
,-0.057004265
,-0.029878039
,0.023598962
,0.07194385
,0.105487294
,0.12519561
,0.09613564
,0.007089533
,-0.085464425
,-0.12298985
,-0.11305902
,-0.121826544
,-0.1644643
,-0.105310425
,0.15826434
,0.4392001
,0.46852982
,0.2840551
,0.14105207
,0.13159674
,0.11072081
,-0.061285973
,-0.34145588
,-0.5546929
,-0.5966939
,-0.54064137
,-0.49359775
,-0.39593226
,-0.10060978
,0.26256043
,0.3338502
,0.11291689
,0.011505902
,0.22645104
,0.51163936
,0.5886847
,0.4690901
,0.3118071
,0.17373627
,0.018461704
,-0.14671174
,-0.26167107
,-0.2878347
,-0.22277357
,-0.099516705
,0.00232622
,0.010380462
,-0.064100936
,-0.14591467
,-0.16949007
,-0.0873984
,0.105982065
,0.29139024
,0.2886983
,0.052495196
,-0.26500535
,-0.4384026
,-0.3714958
,-0.19379057
,-0.08808473
,-0.055342823
,0.03136465
,0.19249758
,0.3111133
,0.30862093
,0.21963957
,0.11711403
,0.067345634
])  # 여기에 심박 신호 값을 추가합니다.

# 측정 시간 (15초)
duration = 60

# 샘플링 빈도 추정
fs = len(raw_signal) / duration

# 필터링 및 피크 찾기 (최소 피크 높이와 거리 조정)
filtered_signal = scipy.signal.medfilt(raw_signal, kernel_size=1)
peaks, _ = scipy.signal.find_peaks(filtered_signal, distance=fs//3, height=0.14)

# 심박수 파악
bpm = len(peaks) * 60 / duration # 거리 약 20cm

plt.figure(figsize=(15,5))
plt.plot(raw_signal, label="Raw signal")
plt.plot(filtered_signal, label="Filtered signal", linestyle="--")
plt.plot(peaks, filtered_signal[peaks], 'r*', markersize=10, label="Peaks")
plt.title(f"Estimated Heart Rate: {bpm:.1f} BPM")
plt.legend()
plt.show()